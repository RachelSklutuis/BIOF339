---
title: "R Final Project"
author: "George Mo"
date: "12/16/2019"
output: html_document
---
# Visualizing 2019-2020 NBA Season Stats

Introduction: For my R final project, I look at some data from this year's NBA season using various visualization techniques available through R. I then look at various stats of players and see whether or not there is any correlation between them. 

```{r start, warning = FALSE, message = FALSE}
library(plotly)
library(readxl)
library(d3heatmap)
library(viridis)
library(tidyverse)
library(ggfortify)

NBA_Player_Stats_master <- read_excel("C:/Users/mog2/Downloads/2019-2020 NBA Player Stats  NBAstuffer.xlsx", skip = 1)
head(NBA_Player_Stats_master)
```

To tidy the data, I select the columns of information that I want and also change the column names.
```{r 1}
NBA_Player_Stats <- NBA_Player_Stats_master %>%
 select(c(2:7,11:16,19,20,22,24:26))

colnames(NBA_Player_Stats)[13:18] <- c("PPG","RPG","APG","SPG","BPG","TOPG")
```

Currently, the table is arranged with the players and their respective teams, so I wanted to look at the range of points scored by players on each team. To do this, I used ggplot with boxplots and faceted the data by teams.

```{r 2}
p <- ggplot(NBA_Player_Stats, aes(x = TEAM, y = `PPG`, fill = TEAM)) + geom_boxplot() + scale_fill_viridis(discrete = TRUE, alpha=0.6) +
    geom_jitter(color="black", size=0.4, alpha=0.9)
ggplotly(p)
```

I grouped the data by TEAM and added an additional column labeled as total_ppg. I then imported another data table and joined them by team name to get win percentage.

```{r 2.1}
Winning <- NBA_Player_Stats
Winning <- Winning %>%
  group_by(TEAM) %>%
  mutate(total_ppg = sum(PPG))
Standings <- read_excel("C:/Users/mog2/Downloads/2019-2020 NBA Standings.xlsx")
Winning <- left_join(Winning,Standings, by = 'TEAM')
```

```{r 2.2}
p5 <- plot_ly(Winning, x = ~total_ppg, y = ~`Win%`, type = 'scatter', mode = 'markers',
             marker = list(size = 5, opacity = 0.5),
             hoverinfo = 'text',
             text = ~paste('Team:', `TEAM`, '<br> Win%:', `Win%`, '<br> Total average PPG:', total_ppg)) %>%
  layout(title = 'Total average PPG versus win percentage')
p5

WinningLinear <- lm(total_ppg ~ `Win%`, data = Winning)
broom::tidy(WinningLinear)
broom::glance(WinningLinear)
autoplot(WinningLinear)
cor(Winning$`total_ppg`, Winning$`Win%`)
```

I wanted to look at some of the stats of the top 50 scoring NBA players and see how their other stats compared. 

```{r 3}
Top_20 <- NBA_Player_Stats %>%
  arrange(desc(PPG))
Top_20 <- Top_20[1:20,]
```

```{r 4}
Top_20_d3heatmap <- Top_20 %>%
  select('FULL NAME',13:18)
row.names(Top_20_d3heatmap) <- Top_20_d3heatmap$`FULL NAME`
Top_20_d3heatmap$`FULL NAME` <- NULL
p2 <- d3heatmap(scale(Top_20_d3heatmap), dendrogram = 'none', color = "Blues")
p2
```

I was then curious to see if a player's shooting percentage (2P%, 3P%, FT%) had any correlation with a player's PPG. First, I filtered the initial dataset to only include players that had shot above the average number of shots. Then I graphed percentage versus PPG. The dot size and color represents the overall number of shots taken.

```{r 6}
TwoPA <- NBA_Player_Stats %>%
  filter(`2PA` > mean(`2PA`))

ThreePA <- NBA_Player_Stats %>%
  filter(`3PA` > mean(`3PA`))

FTA <- NBA_Player_Stats %>%
  filter(`FTA` > mean(`FTA`))

p5 <- plot_ly(TwoPA, x = ~`2P%`, y = ~PPG, type = 'scatter', mode = 'markers', color = ~`2PA`, colors = 'Blues',
             marker = list(size = ~`2PA`/10, opacity = 0.5),
             hoverinfo = 'text',
             text = ~paste('Player:', `FULL NAME`, '<br> PPG:', PPG, '<br> 2PA:', `2PA`, '<br> 2P%:', `2P%`)) %>%
  layout(title = '2 pointer percentage versus PPG')
p5

p6 <- plot_ly(ThreePA, x = ~`3P%`, y = ~PPG, type = 'scatter', mode = 'markers', color = ~`3PA`, colors = 'Reds',
             marker = list(size = ~`3PA`/10, opacity = 0.5),
             hoverinfo = 'text',
             text = ~paste('Player:', `FULL NAME`, '<br> PPG:', PPG, '<br> 3PA:', `3PA`, '<br> 3P%:', `3P%`)) %>%
  layout(title = '3 pointer percentage versus PPG')
p6

p7 <- plot_ly(FTA, x = ~`FT%`, y = ~PPG, type = 'scatter', mode = 'markers', color = ~`FTA`, colors = 'Greens',
             marker = list(size = ~`FTA`/10, opacity = 0.5),
             hoverinfo = 'text',
             text = ~paste('Player:', `FULL NAME`, '<br> PPG:', PPG, '<br> FTA:', `FTA`, '<br> FT%:', `FT%`)) %>%
  layout(title = 'Free throw percentage versus PPG')
p7
```

```{r 7}
TwoPALinear <- lm(`2P%` ~ PPG, data = TwoPA)
broom::tidy(TwoPALinear)
broom::glance(TwoPALinear)
autoplot(TwoPALinear)
cor(TwoPA$`2P%`, TwoPA$`PPG`)

ThreePALinear <- lm(`3P%` ~ `PPG`, data = ThreePA)
broom::tidy(ThreePALinear)
broom::glance(ThreePALinear)
autoplot(ThreePALinear)
cor(ThreePA$`3P%`, ThreePA$`PPG`)

FTALinear <- lm(`FT%` ~ `PPG`, data = FTA)
broom::tidy(FTALinear)
broom::glance(FTALinear)
autoplot(FTALinear)
cor(FTA$`FT%`, FTA$`PPG`)
```


Conclusion: Overall, FT% seemed to have the largest correlation coefficient with PPG (0.34) whereas 2P% and 3P% did not. In addition, there was not really any correlation between total points per game scored by a team and their winning percentage.