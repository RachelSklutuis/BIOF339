---
title: "Final project"
author: "Julie Brault"
date: "12/15/2019"
output: 
  ioslides_presentation:
    smaller: TRUE
    fig_width: 7
    fig_height: 4.5

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Messenger RNA-correction of MAGT1-deficient T cells from patients with XMEN disease {.smaller}

<div class="columns-2">

- 'X-linked immunodeficiency with Magnesium defect, Epstein-Barr virus (EBV) infection, and Neoplasia'
- Loss-of-function mutations in MAGT1 gene encoding magnesium transporter 1
- Loss of NKG2D expression in NK and CD8+ T cells 
- Decreased cytotoxic function mediated by NKG2D
- Chronic EBV infection, EBV-related lymphoproliferative disorders

![](XMEN disease.png){width=80%} 


</div>

## Workflow of the project

![](Workflow2.png){width=90%} 

## Assessing the safety of electroporation of MAGT1 mRNA

![](Nanostring.png){width=90%} 


## Import of the data

```{r, echo=FALSE, warning=FALSE}
library(readxl)
library(tableone)
library(ggplot2)
```

```{r, echo = TRUE}
Nanostring_data <- read_excel("Data/MAGT1_mRNA_normalized.xls")
head(Nanostring_data)
```



## Tidying the data

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
```

1) remove unnecessary columns
2) gather/select to have the Sample# in the first column
3) apply the treatment (Naive/EP0/EP400) to each sample 

```{r, echo=TRUE}
Nanostring_tidy <- Nanostring_data %>% 
  select('Gene', 'Sample1':'Sample12') %>% 
  gather(key = ID, value = expression, -'Gene') %>% 
  select('ID', 'Gene', 'expression')
Nanostring_ttt <- read_excel("Data/Treatment.xlsx")
Nanostring_fulldata <- right_join(Nanostring_tidy, Nanostring_ttt, by=c('ID')) %>% 
  select('ID', 'Treatment', 'Gene', 'expression') %>% 
  mutate(Treatment=as.factor(Treatment))
Nanostring_fulldata$log.expression <- log(Nanostring_fulldata$expression)
head(Nanostring_fulldata)
```


## First look at the data: heat map

```{r, echo = TRUE, fig.align="center", out.height = "400px", out.width="600px"}
library(ggplot2)
HM1 <- ggplot(Nanostring_fulldata, mapping = aes(x=ID, y=Gene, fill=log.expression)) +
    geom_tile() +
  theme(axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, vjust = 0.5))
HM1
```


## Removing uninterpretable samples and stratifiying by treatment

```{r, echo=FALSE}
Nanostring_analysis <- Nanostring_fulldata %>% 
  filter(ID == 'Sample1'|ID == 'Sample2'|ID == 'Sample3'|ID == 'Sample7'|ID == 'Sample8'|ID == 'Sample9'|ID == 'Sample10'|ID == 'Sample11'|ID == 'Sample12') 
```


```{r, echo=TRUE}
library(tableone)
Tab1 <- CreateTableOne(data = Nanostring_analysis[,1:2])
kableone(print(Tab1), format='html')
```


## Boxplot showing a selection of genes published in the literature
```{r, echo=FALSE}
Nanostring_analysis2 <- Nanostring_analysis %>% 
  filter(Gene == 'NFKB1'|Gene == 'IRF1'|Gene == 'IRF3'|Gene == 'IRF5'|Gene == 'IFNA1'|Gene == 'IFNB1'|Gene == 'IFNG'|Gene == 'OAS2'|Gene == 'OASL'|Gene == 'MX1'|Gene == 'IFI44'|Gene == 'IFIT1'|Gene == 'IFIT2'|Gene == 'IFIT3'|Gene == 'IL1B'|Gene == 'IL6'|Gene == 'IL10'|Gene == 'IL18'|Gene == 'TNF'|Gene == 'TGFB1'|Gene == 'JUN') 
```

```{r, fig.align="center", out.height = "400px", out.width="600px"}
Fig1 <- ggplot(Nanostring_analysis2,
               mapping = aes(x= Gene, y = log.expression, fill = Treatment)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
Fig1
```

## Statistical analysis of the data 

```{r, echo=FALSE, warning=FALSE}
Nanostring_stat <- Nanostring_analysis2 %>% 
  select(ID, Treatment, Gene, log.expression) %>% 
  spread(key = Gene, value = log.expression)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, comment = ""}
Tab3 <- CreateTableOne(
  data = Nanostring_stat[,-1],
  vars = Nanostring_stat %>%
    names(),
  strata = 'Treatment')
print(Tab3, format='html')
```

