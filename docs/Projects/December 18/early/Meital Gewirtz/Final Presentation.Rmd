---
title: "Investigating the Spleen in Patients Treated for Hepatitis C"
author: "Meital Gewirtz"
date: "12/16/2019"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Progression of Hepatitis C

![](hepCprog.jpg)

## HCV as a Model

![](disease.jpeg){width=250px}

HCV is the leading cause of cirrhosis

![](prevalence.pbm){width=270px}

HCV global burden is estimated at 70-270 million infected individuals

## Study Design

- 20 patients treated for hepatitis C
- 8 Cirrhotic / 12 Non-Cirrhotic
- Blood taken from periphery, portal vein, spleen
- Tested for various biomarkers
- Questions: 
1. How do biomarkers in splenic blood differ in cirrhotics as compared to noncirrhotics? 
2. How do biomarkers in splenic blood differ in comparison to portal and peripheral blood?

## Libraries

```{r, echo = TRUE}
library(tidyverse)
library(rio)
library(broom)
library(data.table)
```

## Reading data into R

```{r, echo = TRUE}
Spleen_PII <- readxl::read_excel('Spleen Phase 2 Oct31.xlsx', sheet='Sheet1')
SPP_P2 <- readxl::read_excel('SiteSpecific.xlsx', sheet='Sheet1')
```
## Data Munging
```{r, echo = TRUE}
## Pasting B- onto every Biomarker row
BM1 = names(Spleen_PII)
BM1[11:95]= paste0('B-',BM1[11:95])
names(Spleen_PII) = BM1
## Selecting for the numeric rows
numeric_names <- Spleen_PII %>% select_if(is.numeric) %>% names()
```
## Data Munging
```{r, echo=TRUE, warning = FALSE}
## First, I'm selecting for cirrhotic status and any other column 
## that's numeric, then I'm gathering by biomarker and adding the
## "Expression" column. Then I'm creating a list by splitting by 
## biomarker. Next, I'm running a wilcoxon test to 
## see if biomarker expression varies by cirrhotic status
tst <- Spleen_PII %>% 
  select(Cirrhotic, numeric_names) %>% 
  tidyr::gather(Biomarker, Expression, starts_with('B-')) %>% 
  split(.$Biomarker) %>% 
  map(function(d){d
      wilcox.test(Expression ~ Cirrhotic, data = d) %>% 
      broom::tidy()
  }) %>% 
  bind_rows(.id = 'Biomarker')
```

## Plotting P-values
```{r, echo = FALSE, warning = FALSE, fig.height=5}
ggplot(tst %>% mutate(Biomarker = str_remove(Biomarker, 'B-')), 
       aes(x = Biomarker, y = -log10(p.value)))+
  geom_point()+
  coord_flip()
```

## Peptidoglycan
```{r, echo = FALSE, warning = FALSE}
ggplot(Spleen_PII, 
       aes(x = `Cirrhotic`, y = `B-Peptidoglycan Mono Adjusted(ng/ml)`, 
           group = `Cirrhotic`))+
  geom_boxplot()+
  labs(x = 'Cirrhotic Status', 
       y = 'Peptidoglycan Mono Adjusted (ng/ml)')
```

## More Data Munging
```{r, echo = TRUE, warning = FALSE}
## Pasting B- onto each Biomarker
BM1 = names(SPP_P2)
BM1[3:4]= paste0('B-',BM1[3:4])
BM1[9:78]= paste0('B-', BM1[9:78])
names(SPP_P2) = BM1
## Selecting for Numeric Rows
numeric_names1 <- SPP_P2 %>% select_if(is.numeric) %>% names()
```
## More Data Munging
```{r, echo = TRUE, warning = FALSE}

flat_cor <- function(dd){
  c1 <- cor(dd, use='pair') # compute correlations, use available pairs
  c2 <- c1[upper.tri(c1)] # Extract out the pairwise correlations
  out <- as.data.frame(t(c2)) # format into a data frame
  names(out) <- c('PeripheralPortal','PeripheralSpleen','PortalSpleen') # rename
  return(out)
}
## First, I'm selecting for cirrhotic status and any other column that's numeric, then 
## I'm gathering by biomarker and adding the "Expression" column
## Then I'm creating a list by splitting into datasheets by biomarker
SPP_P2_tst1 <- SPP_P2 %>% 
  select(Cirrhotic, numeric_names1, Site) %>% 
  tidyr::gather(Biomarker, Expression, starts_with('B-')) %>% 
  spread(Site, Expression) %>% 
  split(.$Biomarker) %>% 
  map(function(d){
    flat_cor(select(d, Peripheral:Spleen)) 
  }) %>% 
  bind_rows(.id = 'Biomarker')
```
## Correlation Portal-Spleen
```{r, echo = FALSE, warning = FALSE}
ggplot(SPP_P2_tst1 
       %>% mutate(Biomarker = str_remove(Biomarker, 'B-')), 
       aes(fct_reorder(Biomarker, PortalSpleen), PortalSpleen))+
  geom_point()+
  labs(x = 'Biomarker',
       y = 'Correlation Portal-Spleen')+
  coord_flip()
```

## Correlation Peripheral-Spleen
```{r, echo=FALSE, warning = FALSE}
ggplot(SPP_P2_tst1 
       %>% mutate(Biomarker = str_remove(Biomarker, 'B-')), 
       aes(fct_reorder(Biomarker,PeripheralSpleen), PeripheralSpleen))+
  geom_point()+
  labs(x = 'Biomarker',
       y = 'Correlation Peripheral-Spleen')+
  coord_flip()
```
