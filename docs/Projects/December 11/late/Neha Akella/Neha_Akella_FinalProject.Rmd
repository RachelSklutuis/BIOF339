---
title: "Final Project"
author: "Neha Akella"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(rio)
library(ggplot2)
```

## Introduction

The data that I will be analyzing is from an Open Field test. Mice are placed in a box where the center is illuminated with a bright light, and are allowed to roam freely. This protocol assays locomotor activity, measured by the distance traveled over time, and anxiety, measured by the amount of time spent in the bright center. I will be looking at two groups of mice - control and one injected with a fl/fl cre virus - and see whether there is a significant difference in performance.  

## Tidying and Manipulating data

```{r message=FALSE, warning=FALSE}
names <- dir('data', pattern = 'csv', full.names=T)
OF_data <- import(names) #importing file
print(OF_data[c(1:5), 1:10])

OF_data <- OF_data %>% mutate(Virus = tolower(Virus)) %>%
  select('Animal', 'Segment of test', 'Distance', 'Center : time', 'Virus', 'Sex') %>% #selecting necessary columns
  rename(Time = `Segment of test`, CenterTime = `Center : time`) %>% #renaming to make easier
  gather(key = 'Data_Type', value = 'Value', Distance, CenterTime) %>%
  unite('Combined', Time, Data_Type) %>%
  spread('Combined', 'Value') %>%
  rename_at(vars(starts_with('0 - 300')), funs(str_replace(., '0 - 300 secs.', 'min5'))) %>%
  rename_at(vars(starts_with('300 -')), funs(str_replace(., '300 - 600 secs.', 'min10'))) %>%
  rename_at(vars(starts_with('600 -')), funs(str_replace(., '600 - 900 secs.', 'min15'))) %>%
  rename_at(vars(starts_with('900 -')), funs(str_replace(., '900 - 1200 secs.', 'min20'))) %>%
  rename_at(vars(starts_with('1200 -')), funs(str_replace(., '1200 - 1500 secs.', 'min25'))) %>%
  rename_at(vars(starts_with('1500 -')), funs(str_replace(., '1500 - 1800 secs.', 'min30'))) %>% #creating different time columns for distance and time in center, renaming to make easier
  select(Animal, Virus, Sex, min5_Distance, min10_Distance, min15_Distance, min20_Distance, min25_Distance, min30_Distance, min5_CenterTime, min10_CenterTime, min15_CenterTime, min20_CenterTime, min25_CenterTime, min30_CenterTime) %>% #reordering data
  arrange(Virus)
print(OF_data[c(1:5), 1:15])

OF_totals<- OF_data %>% mutate(Total_Distance = rowSums(.[4:9]), Total_CenterTime = rowSums(.[10:15])) #new data set totaling the sum of the distance traveled and time in center for each animal
print(OF_totals[c(1:5), 1:17])

OF_data <- OF_data %>% gather(key = 'Time_point', value = 'Value', -Virus, -Sex, -Animal) %>%
  separate(Time_point, c('Time_point', 'Data_type'), sep = '_', fill='right') %>%
  separate(Time_point, c(NA, 'Time_point'), sep = 3) %>%
  mutate(Time_point = as.numeric(Time_point)) #tidying original data set further for line graphs
print(OF_data[c(1:5), 1:6])
```

## Plots

```{r message=FALSE, warning=FALSE}
sem <- function(x) sqrt(var(x, na.rm=T)/sum(!is.na(x)))


Total_Distance_plot <- OF_totals %>% group_by(Virus) %>% 
  summarize(meanTotal_Distance = mean(Total_Distance),
            semTotal_Distance = sem(Total_Distance)) %>%
  ggplot(aes(x = Virus, y = meanTotal_Distance, fill = Virus)) + 
  geom_col(show.legend = FALSE) +
  geom_errorbar(aes(ymin=meanTotal_Distance - semTotal_Distance, 
                    ymax= meanTotal_Distance + semTotal_Distance), show.legend = FALSE,
                width = 0.3) +
  labs(y = 'Total Distance (m)')#graph comparing total distance traveled of cre and ctrl
Total_Distance_plot <- Total_Distance_plot + 
  geom_point(data = OF_totals, mapping = aes(x = Virus, y = Total_Distance, group = Virus),
             show.legend = FALSE)
Total_Distance_plot


Total_CenterTime_plot <- OF_totals %>% group_by(Virus) %>% 
  summarize(meanTotal_CenterTime = mean(Total_CenterTime),
            semTotal_CenterTime = sem(Total_CenterTime)) %>%
  ggplot(aes(x = Virus, y = meanTotal_CenterTime, fill = Virus)) + 
  geom_col(show.legend = FALSE) + 
  geom_errorbar(aes(ymin=meanTotal_CenterTime - semTotal_CenterTime, 
                    ymax= meanTotal_CenterTime + semTotal_CenterTime), show.legend = FALSE,
                width = 0.3) +
  labs(y = 'Total Time in Center (s)') #comparing time in center of cre and ctrl
Total_CenterTime_plot <- Total_CenterTime_plot + 
  geom_point(data = OF_totals, mapping = aes(x = Virus, y = Total_CenterTime, group = Virus),
             show.legend = FALSE)
Total_CenterTime_plot


Time_point_Distance_plot <- OF_data %>% select(Virus, Data_type, Time_point, Value) %>% 
  filter(Data_type == 'Distance') %>%
  group_by(Virus, Time_point) %>% summarize(meanValue = mean(Value), 
                                     semValue = sem(Value)) %>%
  ggplot(aes(x = Time_point, y = meanValue, color = Virus, group = Virus)) + geom_line() + 
  geom_point() + theme(legend.title = element_blank()) +
  geom_errorbar(aes(ymin=meanValue - semValue, ymax= meanValue + semValue), width = 0.4) + 
  labs (x = 'Minute', y = 'Distance Traveled (m)') #line graph comparing distance traveled of cre and ctrl
Time_point_Distance_plot

Time_point_CenterTime_plot <- OF_data %>% select(Virus, Data_type, Time_point, Value) %>% 
  filter(Data_type == 'CenterTime') %>%
  group_by(Virus, Time_point) %>% summarize(meanValue = mean(Value), 
                                            semValue = sem(Value)) %>%
  ggplot(aes(x = Time_point, y = meanValue, color = Virus, group = Virus)) + geom_line() + 
  geom_point() + theme(legend.title = element_blank()) +
  geom_errorbar(aes(ymin=meanValue - semValue, ymax= meanValue + semValue), width = 0.4) + 
  labs (x = 'Minute', y = 'Time in Center (s)') #line graph comparing time in spent in center of cre and ctrl
Time_point_CenterTime_plot
```

## Statistical Tests

```{r message = FALSE, warning = FALSE}
Total_Distance_statistics <- t.test(Total_Distance ~ Virus, data= OF_totals) %>%
  broom::tidy()
Total_Distance_statistics$p.value

Total_CenterTime_statistics <- t.test(Total_CenterTime ~ Virus, data = OF_totals) %>%
  broom::tidy()
Total_CenterTime_statistics$p.value
```

## Conclusion

Based on the graphs and p-values, there seems to be no significant difference between the two groups of mice. 
