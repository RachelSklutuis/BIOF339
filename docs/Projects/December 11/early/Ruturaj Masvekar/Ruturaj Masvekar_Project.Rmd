---
title: "BIOF-339_Project"
author: "Ruturaj Masvekar"
date: "11/25/2019"
output: html_document
---
# Activate required packages
```{r include=FALSE}
library(readr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(corrplot)
library(Hmisc)
library(tableone)
```

# Import and Merge data sets, and change variables to desired class
```{r include=FALSE}
Demographics <- read_csv("Data/Demographics.csv")
MRI <- read_csv("Data/MRI.csv")
Proteomics <- read_csv("Data/Proteomics.csv")

Final <- Demographics %>%
  full_join(MRI) %>%
  full_join(Proteomics)
str(Final)

names <- c(3:5)
Final[,names] <- lapply(Final[,names], factor)
str(Final)

Final$Activity <- factor(Final$Activity,
                          levels = c('non-active', 'active'), ordered = TRUE)
```

# Table1: Demographics across Disease Activity
```{r echo=FALSE}
myvars=c('Age', 'Gender', 'Race')
tab1 <- CreateTableOne(data=Final,
                       vars=myvars,
                       strata='Activity')
kableone(print(tab1), format = 'html')
```

# Table2: Biomarkers across Disease Activity
```{r echo=FALSE}
Biomarkers <- Final[,c(7:25)] %>% names()
tab2 <- CreateTableOne(data=Final,
                      vars=Biomarkers,
                      strata='Activity',
                      testNormal = t.test)
kableone(print(tab2), format = 'html')
```

# Figure1: Boxplots of statistically significant (p < 0.01) Biomarkers across Disease Activity
```{r echo=FALSE, warning=FALSE}
plot_NfL <- ggplot(data = Final,
                aes(x = Activity,
                    y = NfL)) +
  geom_boxplot() +
  labs(x = '',
       y = 'NfL (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_TNFa <- ggplot(data = Final,
                aes(x = Activity,
                    y = TNFa)) +
  geom_boxplot() +
  labs(x = '',
       y = expression(paste("TNF", alpha, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_TNFB <- ggplot(data = Final,
                aes(x = Activity,
                    y = TNFB)) +
  geom_boxplot() +
  labs(x = '',
       y = expression(paste("TNF", beta, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_IL10 <- ggplot(data = Final,
                aes(x = Activity,
                    y = `IL-10`)) +
  geom_boxplot() +
  labs(x = '',
       y = 'IL-10 (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_TGFB <- ggplot(data = Final,
                aes(x = Activity,
                    y = TGFB)) +
  geom_boxplot() +
  labs(x = '',
       y = expression(paste("TGF", beta, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_IL12p40 <- ggplot(data = Final,
                aes(x = Activity,
                    y = `IL-12p40`)) +
  geom_boxplot() +
  labs(x = '',
       y = 'IL-12p40 (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_CHI3L1 <- ggplot(data = Final,
                aes(x = Activity,
                    y = CHI3L1)) +
  geom_boxplot() +
  labs(x = '',
       y = 'CHI3L1 (ng/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_compare_means(method = "t.test", label = "p.format", size = 3.25)

plot_grid(plot_NfL, plot_TNFa, plot_TNFB, plot_IL10, plot_TGFB, plot_IL12p40, plot_CHI3L1, 
          ncol = 3)
```

# Figure2: Correltions bwetween CEL and statistically significant Biomarkers_Active MS Subjects
```{r echo=FALSE, warning=FALSE}
Active <- filter(Final, Activity == 'active')

CEL_NfL <- ggplot(data = Active,
                aes(x = CEL,
                    y = NfL)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = 'NfL (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_TNFa <- ggplot(data = Active,
                  aes(x = CEL,
                      y = TNFa)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = expression(paste("TNF", alpha, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_TNFB <- ggplot(data = Active,
                   aes(x = CEL,
                       y = TNFB)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = expression(paste("TNF", beta, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_IL10 <- ggplot(data = Active,
                   aes(x = CEL,
                       y = `IL-10`)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = 'IL-10 (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_TGFB <- ggplot(data = Active,
                   aes(x = CEL,
                       y = TGFB)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = expression(paste("TGF", beta, " (pg/ml)"))) +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_IL12p40 <- ggplot(data = Active,
                   aes(x = CEL,
                       y = `IL-12p40`)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = 'IL-12p40 (pg/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

CEL_CHI3L1 <- ggplot(data = Active,
                   aes(x = CEL,
                       y = CHI3L1)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = 'CELs (number)',
       y = 'CHI3L1 (ng/ml)') +
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 8),
        axis.ticks = element_blank()) +
  stat_cor(method = "spearman", size = 3.25)

plot_grid(CEL_NfL, CEL_TNFa, CEL_TNFB, CEL_IL10, CEL_TGFB, CEL_IL12p40, CEL_CHI3L1, 
          ncol = 3)
```

# Figure3: Correlogram of statistically significant Biomarkers_All MS Subjects
```{r echo=FALSE}
Data <- Final[,c(7, 8, 10, 14, 15, 17, 25)]

mat <- rcorr(as.matrix(Data), type = "spearman")

corrplot(mat$r, method = "circle", type = "full", tl.col = "black", order = "hclust",
         p.mat = mat$P, sig.level = 0.01, insig = "blank",
         col = colorRampPalette(c("blue", "white", "red"))(200))
```










